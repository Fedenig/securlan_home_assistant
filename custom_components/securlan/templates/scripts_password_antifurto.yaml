script:
  save_alarm_code:
    alias: "Salva password allarme"
    sequence:
      # 1. Memorizza la password inserita
      - variables:
          new_pwd: "{{ states('input_text.alarm_code') }}"
      # 2. Salva su Securlan
      - service: securlan.set_password
        data:
          key: password_allarme
          value: "{{ new_pwd }}"
      # 3. Aggiorna l‚Äôinput_text.password_allarme
      - service: input_text.set_value
        target:
          entity_id: input_text.password_allarme
        data:
          value: "{{ new_pwd }}"
      # 4. Pulisci il campo input
      - service: input_text.set_value
        target:
          entity_id: input_text.alarm_code
        data:
          value: ""

  get_password_notification:
    alias: "Mostra password allarme in notifica"
    sequence:
      - variables:
          current_pwd: "{{ states('input_text.password_allarme') }}"

      - service: persistent_notification.create
        data:
          title: "üîë Password Allarme"
          message: >
            {% if current_pwd != "" %}
            La password attuale √®: **{{ current_pwd }}**
            {% else %}
            ‚ö†Ô∏è Nessuna password impostata
            {% endif %}
          notification_id: password_allarme_info

  get_password_popup: 
    alias: "Mostra password allarme"
    sequence:
      - variables:
          current_pwd: "{{ states('input_text.password_allarme') }}"

      - service: browser_mod.popup
        data:
          title: "üîë Password Allarme"
          content:
            type: markdown
            content: |
              **Password attuale:**  
              **{{ current_pwd if current_pwd != '' else '‚Äî non impostata ‚Äî' }}**

          
